<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- –®—Ä–∏—Ñ—Ç—ã -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- –ò–∫–æ–Ω–∫–∏ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- –ù–∞—à–∏ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <title>Everist - –ú–∞–≥–∞–∑–∏–Ω</title>
    <link rel="icon" type="image/png" href="../img/logo1.png">
    
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ */
        .shop-container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }
        
        .shop-header {
            margin-bottom: 40px;
            text-align: center;
        }
        
        .shop-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #000;
        }
        
        .shop-description {
            font-size: 16px;
            color: #666;
            max-width: 600px;
            margin: 0 auto 30px;
        }
        
        .shop-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .shop-filters {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .filter-select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            cursor: pointer;
        }
        
        .shop-search {
            position: relative;
            width: 300px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .search-button {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
        }
        
        .categories {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .category-btn {
            padding: 10px 25px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .category-btn:hover {
            border-color: #000;
            color: #000;
        }
        
        .category-btn.active {
            background: #000;
            color: white;
            border-color: #000;
        }
        
        /* –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }
        
        .product-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .product-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #000;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            z-index: 2;
        }
        
        .product-badge.sale {
            background: #ff4444;
        }
        
        .product-badge.new {
            background: #4CAF50;
        }
        
        .product-image {
            height: 200px;
            background: #f8f8f8;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .product-image img {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
            transition: transform 0.3s;
        }
        
        .product-card:hover .product-image img {
            transform: scale(1.05);
        }
        
        .quick-view {
            position: absolute;
            bottom: -50px;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            transition: bottom 0.3s;
            cursor: pointer;
        }
        
        .product-card:hover .quick-view {
            bottom: 0;
        }
        
        .product-info {
            padding: 20px;
        }
        
        .product-category {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .product-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #000;
            height: 40px;
            overflow: hidden;
        }
        
        .product-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.4;
            height: 40px;
            overflow: hidden;
        }
        
        .product-price {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .current-price {
            font-size: 20px;
            font-weight: 700;
            color: #000;
        }
        
        .old-price {
            font-size: 16px;
            color: #999;
            text-decoration: line-through;
        }
        
        .product-reviews {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .stars {
            color: #FFD700;
        }
        
        .review-count {
            font-size: 13px;
            color: #666;
        }
        
        .product-features {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .feature-tag {
            background: #f5f5f5;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            color: #666;
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
        }
        
        .add-to-cart-btn {
            flex: 1;
            background: #000;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .add-to-cart-btn:hover {
            background: #333;
        }
        
        .add-to-cart-btn.added {
            background: #4CAF50;
        }
        
        .wishlist-btn {
            width: 44px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .wishlist-btn:hover {
            border-color: #ff4444;
            color: #ff4444;
        }
        
        .wishlist-btn.active {
            background: #ff4444;
            border-color: #ff4444;
            color: white;
        }
        
        /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 50px;
        }
        
        .page-btn {
            width: 40px;
            height: 40px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .page-btn:hover {
            border-color: #000;
        }
        
        .page-btn.active {
            background: #000;
            color: white;
            border-color: #000;
        }
        
        /* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            grid-column: 1 / -1;
        }
        
        .empty-state i {
            font-size: 60px;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 15px;
            color: #333;
        }
        
        .empty-state p {
            color: #666;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .shop-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .shop-search {
                width: 100%;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .categories {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <a href="../index.html" class="logo">EVERIST</a>
        <nav class="nav-links">
            <a href="shop.html" class="active">SHOP</a>
            <a href="../index.html">LEARN</a>
            <a href="#">SUSTAINABILITY</a>
            <a href="#">OUR STORY</a>
            <a href="#">PRESS</a>
        </nav>
        <div class="header-right" id="headerRight">
            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º -->
        </div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main>
        <div class="shop-container">
            <div class="shop-header">
                <h1 class="shop-title">–≠–∫–æ–ª–æ–≥–∏—á–Ω–∞—è –∫–æ—Å–º–µ—Ç–∏–∫–∞</h1>
                <p class="shop-description">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –±–µ–∑–≤–æ–¥–Ω—ã–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç—ã –¥–ª—è –≤–æ–ª–æ—Å –∏ —Ç–µ–ª–∞, 
                    —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Å –∑–∞–±–æ—Ç–æ–π –æ –ø–ª–∞–Ω–µ—Ç–µ –∏ –≤–∞—à–µ–º –∑–¥–æ—Ä–æ–≤—å–µ.
                </p>
            </div>
            
            <div class="shop-controls">
                <div class="shop-filters">
                    <select class="filter-select" id="sortSelect">
                        <option value="featured">–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</option>
                        <option value="price-low">–¶–µ–Ω–∞: –æ—Ç –Ω–∏–∑–∫–æ–π –∫ –≤—ã—Å–æ–∫–æ–π</option>
                        <option value="price-high">–¶–µ–Ω–∞: –æ—Ç –≤—ã—Å–æ–∫–æ–π –∫ –Ω–∏–∑–∫–æ–π</option>
                        <option value="newest">–ù–æ–≤–∏–Ω–∫–∏</option>
                        <option value="rating">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
                    </select>
                    
                    <select class="filter-select" id="priceSelect">
                        <option value="">–í—Å–µ —Ü–µ–Ω—ã</option>
                        <option value="0-20">–î–æ $20</option>
                        <option value="20-40">$20 - $40</option>
                        <option value="40-100">$40+</option>
                    </select>
                </div>
                
                <div class="shop-search">
                    <input type="text" 
                           class="search-input" 
                           id="searchInput" 
                           placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..."
                    >
                    <button class="search-button" id="searchButton">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            
            <div class="categories">
                <button class="category-btn active" data-category="all">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</button>
                <button class="category-btn" data-category="hair">–î–ª—è –≤–æ–ª–æ—Å</button>
                <button class="category-btn" data-category="face">–î–ª—è –ª–∏—Ü–∞</button>
                <button class="category-btn" data-category="body">–î–ª—è —Ç–µ–ª–∞</button>
                <button class="category-btn" data-category="kit">–ù–∞–±–æ—Ä—ã</button>
                <button class="category-btn" data-category="oral">–£—Ö–æ–¥ –∑–∞ –ø–æ–ª–æ—Å—Ç—å—é —Ä—Ç–∞</button>
                <button class="category-btn" data-category="home">–î–ª—è –¥–æ–º–∞</button>
            </div>
            
            <div class="products-grid" id="productsGrid">
                <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            
            <div class="pagination" id="pagination">
                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
    </main>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="../js/data.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            await initializeShop();
        });
        
        let allProducts = [];
        let filteredProducts = [];
        let currentPage = 1;
        const productsPerPage = 9;
        
        async function initializeShop() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            const currentUser = window.dataService?.getCurrentUser();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º header
            updateHeader(currentUser);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã
            await loadProducts();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            setupFilters();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–∏—Å–∫
            setupSearch();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            setupCategories();
        }
        
        function updateHeader(user) {
            const headerRight = document.getElementById('headerRight');
            if (!headerRight) return;
            
            const cartCount = user ? window.dataService.getCartItemCount(user.id) : 0;
            
            if (user) {
                headerRight.innerHTML = `
                    <a href="#" class="search-icon">üîç</a>
                    <a href="profile.html" class="user-icon" title="${user.email}">
                        ${user.name.split(' ')[0] || user.email}
                    </a>
                    <a href="cart.html" class="cart-icon">
                        üõí
                        <span class="cart-badge" style="${cartCount > 0 ? 'display: flex' : 'display: none'}">
                            ${cartCount}
                        </span>
                    </a>
                `;
            } else {
                headerRight.innerHTML = `
                    <a href="#" class="search-icon">üîç</a>
                    <a href="login.html" class="user-icon">üë§</a>
                    <a href="login.html" class="cart-icon">
                        üõí
                        <span class="cart-badge" style="display: none">0</span>
                    </a>
                `;
            }
        }
        
        async function loadProducts() {
            try {
                allProducts = window.dataService.getAllProducts();
                filteredProducts = [...allProducts];
                
                renderProducts();
                renderPagination();
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', error);
                showErrorMessage();
            }
        }
        
        function renderProducts() {
            const productsGrid = document.getElementById('productsGrid');
            if (!productsGrid) return;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const productsToShow = filteredProducts.slice(startIndex, endIndex);
            
            if (productsToShow.length === 0) {
                productsGrid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
                        <button class="btn btn-primary" onclick="resetFilters()">
                            –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                        </button>
                    </div>
                `;
                return;
            }
            
            const currentUser = window.dataService?.getCurrentUser();
            const userCart = currentUser ? window.dataService.getCartItems(currentUser.id) : [];
            
            productsGrid.innerHTML = productsToShow.map(product => {
                const isInCart = userCart.some(item => item.productId === product.id);
                const oldPrice = product.oldPrice ? parseFloat(product.oldPrice) : null;
                const currentPrice = parseFloat(product.price);
                const hasDiscount = oldPrice && oldPrice > currentPrice;
                const discountPercent = hasDiscount 
                    ? Math.round((oldPrice - currentPrice) / oldPrice * 100)
                    : 0;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–µ–π–¥–∂
                let badge = '';
                if (hasDiscount && discountPercent > 0) {
                    badge = `<div class="product-badge sale">-${discountPercent}%</div>`;
                } else if (product.reviews < 20) {
                    badge = `<div class="product-badge new">NEW</div>`;
                } else if (product.reviews > 80) {
                    badge = `<div class="product-badge">BESTSELLER</div>`;
                }
                
                return `
                    <div class="product-card" data-product-id="${product.id}">
                        ${badge}
                        
                        <div class="product-image">
                            <img src="${product.image}" alt="${product.name}" 
                                 onerror="this.src='../img/placeholder.jpg'">
                            <div class="quick-view" onclick="showProductDetail(${product.id})">
                                –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
                            </div>
                        </div>
                        
                        <div class="product-info">
                            <div class="product-category">
                                ${getCategoryName(product.category)}
                            </div>
                            
                            <h3 class="product-name" title="${product.name}">
                                ${product.name}
                            </h3>
                            
                            <p class="product-description" title="${product.description}">
                                ${product.description}
                            </p>
                            
                            <div class="product-price">
                                <span class="current-price">$${currentPrice.toFixed(2)}</span>
                                ${hasDiscount ? `
                                    <span class="old-price">$${oldPrice.toFixed(2)}</span>
                                ` : ''}
                            </div>
                            
                            <div class="product-reviews">
                                <div class="stars">${getStarRating(product.reviews)}</div>
                                <span class="review-count">${product.reviews} –æ—Ç–∑—ã–≤–æ–≤</span>
                            </div>
                            
                            <div class="product-features">
                                ${product.features.slice(0, 2).map(feature => `
                                    <span class="feature-tag">${feature}</span>
                                `).join('')}
                            </div>
                            
                            <div class="product-actions">
                                <button class="add-to-cart-btn ${isInCart ? 'added' : ''}" 
                                        onclick="addToCart(${product.id})" 
                                        ${!currentUser ? 'disabled' : ''}>
                                    ${isInCart ? '‚úì –í –∫–æ—Ä–∑–∏–Ω–µ' : '–í –∫–æ—Ä–∑–∏–Ω—É'}
                                </button>
                                
                                <button class="wishlist-btn" onclick="toggleWishlist(${product.id})">
                                    <i class="far fa-heart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderPagination() {
            const pagination = document.getElementById('pagination');
            if (!pagination) return;
            
            const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let pages = [];
            
            // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            pages.push(1);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–æ–∫—Ä—É–≥ —Ç–µ–∫—É—â–µ–π
            for (let i = Math.max(2, currentPage - 1); i <= Math.min(totalPages - 1, currentPage + 1); i++) {
                if (!pages.includes(i)) pages.push(i);
            }
            
            // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            if (totalPages > 1 && !pages.includes(totalPages)) {
                pages.push(totalPages);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–Ω–æ–≥–æ—Ç–æ—á–∏—è
            let paginationHTML = '';
            
            if (currentPage > 1) {
                paginationHTML += `
                    <button class="page-btn" onclick="goToPage(${currentPage - 1})">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                `;
            }
            
            let prevPage = 0;
            pages.forEach(page => {
                if (page > prevPage + 1) {
                    paginationHTML += '<span class="page-dots">...</span>';
                }
                
                paginationHTML += `
                    <button class="page-btn ${page === currentPage ? 'active' : ''}" 
                            onclick="goToPage(${page})">
                        ${page}
                    </button>
                `;
                
                prevPage = page;
            });
            
            if (currentPage < totalPages) {
                paginationHTML += `
                    <button class="page-btn" onclick="goToPage(${currentPage + 1})">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            }
            
            pagination.innerHTML = paginationHTML;
        }
        
        function setupFilters() {
            const sortSelect = document.getElementById('sortSelect');
            const priceSelect = document.getElementById('priceSelect');
            
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    applyFilters();
                });
            }
            
            if (priceSelect) {
                priceSelect.addEventListener('change', function() {
                    applyFilters();
                });
            }
        }
        
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            
            if (searchInput && searchButton) {
                searchButton.addEventListener('click', performSearch);
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
                
                // –î–µ–±–∞—É–Ω—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ
                let searchTimeout;
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(performSearch, 300);
                });
            }
        }
        
        function setupCategories() {
            const categoryButtons = document.querySelectorAll('.category-btn');
            
            categoryButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ
                    this.classList.add('active');
                    
                    applyFilters();
                });
            });
        }
        
        function applyFilters() {
            const selectedCategory = document.querySelector('.category-btn.active').dataset.category;
            const sortValue = document.getElementById('sortSelect').value;
            const priceValue = document.getElementById('priceSelect').value;
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            if (selectedCategory === 'all') {
                filteredProducts = [...allProducts];
            } else {
                filteredProducts = allProducts.filter(product => 
                    product.category === selectedCategory
                );
            }
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ü–µ–Ω–µ
            if (priceValue) {
                const [min, max] = priceValue.split('-').map(Number);
                filteredProducts = filteredProducts.filter(product => {
                    const price = parseFloat(product.price);
                    if (max) {
                        return price >= min && price <= max;
                    } else {
                        return price <= min;
                    }
                });
            }
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            switch (sortValue) {
                case 'price-low':
                    filteredProducts.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => parseFloat(b.price) - parseFloat(a.price));
                    break;
                case 'newest':
                    // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä—ã —Å –º–µ–Ω—å—à–∏–º–∏ ID - –Ω–æ–≤–µ–µ
                    filteredProducts.sort((a, b) => b.id - a.id);
                    break;
                case 'rating':
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—Ç–∑—ã–≤–æ–≤ (–ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏)
                    filteredProducts.sort((a, b) => b.reviews - a.reviews);
                    break;
                case 'featured':
                default:
                    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                    filteredProducts.sort((a, b) => b.reviews - a.reviews);
                    break;
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            currentPage = 1;
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —Ç–æ–≤–∞—Ä—ã –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—é
            renderProducts();
            renderPagination();
        }
        
        function performSearch() {
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.trim().toLowerCase();
            
            if (!query) {
                applyFilters();
                return;
            }
            
            filteredProducts = allProducts.filter(product => 
                product.name.toLowerCase().includes(query) ||
                product.description.toLowerCase().includes(query) ||
                product.category.toLowerCase().includes(query) ||
                product.features.some(feature => 
                    feature.toLowerCase().includes(query)
                )
            );
            
            currentPage = 1;
            renderProducts();
            renderPagination();
        }
        
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('sortSelect').value = 'featured';
            document.getElementById('priceSelect').value = '';
            
            const categoryButtons = document.querySelectorAll('.category-btn');
            categoryButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === 'all') {
                    btn.classList.add('active');
                }
            });
            
            applyFilters();
        }
        
        function goToPage(page) {
            if (page < 1 || page > Math.ceil(filteredProducts.length / productsPerPage)) {
                return;
            }
            
            currentPage = page;
            renderProducts();
            renderPagination();
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É —Ç–æ–≤–∞—Ä–æ–≤
            const productsGrid = document.getElementById('productsGrid');
            if (productsGrid) {
                productsGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        async function addToCart(productId) {
            const currentUser = window.dataService?.getCurrentUser();
            
            if (!currentUser) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É');
                window.location.href = 'login.html';
                return;
            }
            
            try {
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
                await window.dataService.addToCart(currentUser.id, productId, 1);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂ –≤ header
                window.dataService.updateCartBadge();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ "–í –∫–æ—Ä–∑–∏–Ω–µ"
                const button = document.querySelector(`[onclick="addToCart(${productId})"]`);
                if (button) {
                    button.textContent = '‚úì –í –∫–æ—Ä–∑–∏–Ω–µ';
                    button.classList.add('added');
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        button.textContent = '–í –∫–æ—Ä–∑–∏–Ω–µ';
                    }, 3000);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É');
            }
        }
        
        function toggleWishlist(productId) {
            const button = document.querySelector(`[onclick="toggleWishlist(${productId})"]`);
            const icon = button?.querySelector('i');
            
            if (!button || !icon) return;
            
            if (button.classList.contains('active')) {
                button.classList.remove('active');
                icon.className = 'far fa-heart';
                showNotification('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
            } else {
                button.classList.add('active');
                icon.className = 'fas fa-heart';
                showNotification('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
            }
        }
        
        function showProductDetail(productId) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
            alert('–§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. ID —Ç–æ–≤–∞—Ä–∞: ' + productId);
        }
        
        function showNotification(message) {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-check-circle"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 9999;
                animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                max-width: 300px;
            `;
            
            // –°—Ç–∏–ª–∏ –∞–Ω–∏–º–∞—Ü–∏–∏
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
                
                @keyframes fadeOut {
                    from {
                        opacity: 1;
                    }
                    to {
                        opacity: 0;
                    }
                }
                
                .notification-content {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }
                
                .notification-content i {
                    font-size: 18px;
                }
            `;
            
            document.head.appendChild(style);
            document.body.appendChild(notification);
            
            // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
                if (style.parentNode) {
                    style.remove();
                }
            }, 3000);
        }
        
        function showErrorMessage() {
            const productsGrid = document.getElementById('productsGrid');
            if (!productsGrid) return;
            
            productsGrid.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</h3>
                    <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –∑–∞–π—Ç–∏ –ø–æ–∑–∂–µ</p>
                    <button class="btn btn-primary" onclick="location.reload()">
                        –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    </button>
                </div>
            `;
        }
        
        function getCategoryName(category) {
            const categories = {
                'hair': '–î–ª—è –≤–æ–ª–æ—Å',
                'face': '–î–ª—è –ª–∏—Ü–∞',
                'body': '–î–ª—è —Ç–µ–ª–∞',
                'kit': '–ù–∞–±–æ—Ä—ã',
                'oral': '–£—Ö–æ–¥ –∑–∞ –ø–æ–ª–æ—Å—Ç—å—é —Ä—Ç–∞',
                'home': '–î–ª—è –¥–æ–º–∞',
                'perfume': '–ê—Ä–æ–º–∞—Ç—ã'
            };
            return categories[category] || category;
        }
        
        function getStarRating(reviews) {
            // –ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—Ç–∑—ã–≤–æ–≤
            const rating = Math.min(5, Math.floor(reviews / 20) + 1);
            return '‚òÖ'.repeat(rating) + '‚òÜ'.repeat(5 - rating);
        }
    </script>
</body>
</html>